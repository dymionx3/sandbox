<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M.V. Electronix LLC - PDF Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap');
    
    * { 
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; 
    }
    
    .gradient-bg { 
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%); 
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent; 
      background-clip: text;
    }
    
    .hover-scale { 
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease; 
    }
    
    .hover-scale:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 20px 40px rgba(99, 102, 241, 0.15);
    }
    
    .floating { 
      animation: floating 8s ease-in-out infinite; 
    }
    
    @keyframes floating { 
      0% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-30px) rotate(180deg); }
      100% { transform: translateY(0px) rotate(360deg); }
    }
    
    .text-editor { 
      min-height: 200px; 
      border: 2px solid #e2e8f0; 
      border-radius: 1rem; 
      padding: 1.5rem; 
      outline: none;
      background: white;
    }
    
    .text-editor:focus { 
      border-color: #6366f1; 
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }
    
    .file-drop-zone { 
      transition: all 0.3s ease; 
      border: 3px dashed #cbd5e1;
      background: rgba(249, 250, 251, 0.6);
      border-radius: 1.5rem;
    }
    
    .file-drop-zone.dragover { 
      border-color: #6366f1; 
      background-color: rgba(99, 102, 241, 0.05); 
    }
    
    .slide-in { 
      animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1); 
    }
    
    @keyframes slideIn { 
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .loading-spinner {
      border: 4px solid rgba(99, 102, 241, 0.1);
      border-top: 4px solid #6366f1;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .signature-canvas {
      touch-action: none;
      cursor: crosshair;
      background: white;
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .tool-card {
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .tool-card:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.9) 100%);
    }
    
    .modal-gradient {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(99, 102, 241, 0); }
      100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }
    
    .gradient-border {
      position: relative;
      background: white;
      border-radius: 1.5rem;
    }
    
    .gradient-border::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6, #d946ef);
      border-radius: 1.5rem;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .gradient-border:hover::before {
      opacity: 1;
    }
    
    .glow {
      box-shadow: 0 10px 40px rgba(99, 102, 241, 0.15);
    }
    
    .page-heading {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-50 min-h-screen flex flex-col">
  <!-- Animated Background -->
  <div aria-hidden="true" class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 floating"></div>
    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-indigo-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 floating" style="animation-delay: 2s"></div>
    <div class="absolute top-1/2 left-1/3 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-3xl opacity-15 floating" style="animation-delay: 4s"></div>
  </div>

  <!-- Header -->
  <header class="relative z-10 glass-effect shadow-lg mb-8" role="banner">
    <div class="max-w-7xl mx-auto px-6 py-5">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4" aria-label="App brand">
          <div class="w-14 h-14 gradient-bg rounded-2xl grid place-items-center shadow-lg glow" aria-hidden="true">
            <i class="fas fa-file-pdf text-white text-3xl"></i>
          </div>
          <div>
            <h1 class="page-heading text-3xl font-bold gradient-text">PDF Studio</h1>
            <p class="text-sm text-gray-600 mt-1">by <span class="font-semibold text-indigo-600">M.V. Electronix LLC</span></p>
          </div>
        </div>
        <div class="hidden md:flex items-center gap-2 bg-white/80 px-4 py-2 rounded-full">
          <i class="fas fa-shield-alt text-indigo-500"></i>
          <span class="text-sm font-medium text-gray-700">100% Client-Side Processing</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative z-10 py-12 md:py-16 flex-grow">
    <div class="max-w-6xl mx-auto px-6 text-center">
      <div class="inline-block mb-6 px-4 py-2 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-full">
        <span class="text-sm font-semibold text-indigo-600">Professional PDF Tools</span>
      </div>
      <h2 class="page-heading text-5xl md:text-7xl mb-8 leading-tight">
        <span class="gradient-text">Transform Your</span><br>
        <span class="text-gray-800">PDF Workflow</span>
      </h2>
      <p class="text-xl text-gray-600 mb-10 max-w-3xl mx-auto leading-relaxed">Powerful, privacy-focused PDF tools by M.V. Electronix LLC. Create, edit, merge, sign, and more — all processed in your browser.</p>
      <button onclick="scrollToTools()" 
              class="gradient-bg text-white px-10 py-5 rounded-2xl font-semibold hover-scale shadow-2xl pulse
                     focus:outline-none focus:ring-4 focus:ring-indigo-300 flex items-center justify-center gap-3 mx-auto text-lg">
        Explore Tools <i class="fas fa-arrow-down animate-bounce"></i>
      </button>
    </div>
  </section>

  <!-- Tools -->
  <section id="tools" class="relative z-10 py-12 md:py-20 px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h3 class="page-heading text-4xl md:text-5xl mb-6 gradient-text">Powerful PDF Toolkit</h3>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">Everything you need to work with PDFs efficiently and securely</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Tool Cards -->
        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('create')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-plus-circle text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Create PDF</h4>
          <p class="text-gray-600 text-center mb-6">Create PDFs from text, images, or blank documents with custom formatting</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('fill')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-signature text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Fill & Sign</h4>
          <p class="text-gray-600 text-center mb-6">Add text fields and digital signatures to your documents</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('edit')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-pencil-alt text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Edit PDF</h4>
          <p class="text-gray-600 text-center mb-6">Add annotations, drawings, and markups to your PDFs</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('merge')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-layer-group text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Merge PDFs</h4>
          <p class="text-gray-600 text-center mb-6">Combine multiple PDFs into one document with drag-and-drop reordering</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('split')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-cut text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Split PDF</h4>
          <p class="text-gray-600 text-center mb-6">Extract specific pages or split into individual pages</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('compress')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-compress text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Compress PDF</h4>
          <p class="text-gray-600 text-center mb-6">Reduce file size while maintaining quality</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('convert')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-file-arrow-down text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Convert to PDF</h4>
          <p class="text-gray-600 text-center mb-6">Convert images and text files to PDF format</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('watermark')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-stamp text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Add Watermark</h4>
          <p class="text-gray-600 text-center mb-6">Custom text watermarks with full control over appearance</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>

        <div class="tool-card rounded-3xl p-8 hover-scale glow gradient-border cursor-pointer" onclick="openTool('rotate')">
          <div class="w-20 h-20 gradient-bg rounded-2xl grid place-items-center mb-6 shadow-lg mx-auto">
            <i class="fas fa-rotate-right text-white text-3xl"></i>
          </div>
          <h4 class="text-2xl font-bold mb-3 text-gray-800 text-center">Rotate Pages</h4>
          <p class="text-gray-600 text-center mb-6">Rotate all or selected pages in any direction</p>
          <div class="flex justify-center">
            <span class="inline-flex items-center gap-2 text-indigo-600 font-medium">
              Get Started <i class="fas fa-arrow-right"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Banner -->
  <section class="relative z-10 py-16 px-6">
    <div class="max-w-6xl mx-auto">
      <div class="glass-effect rounded-3xl p-12 text-center">
        <h4 class="page-heading text-3xl mb-8 gradient-text">Why Choose PDF Studio?</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="space-y-4">
            <div class="w-16 h-16 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl grid place-items-center mx-auto">
              <i class="fas fa-lock text-2xl text-indigo-600"></i>
            </div>
            <h5 class="text-xl font-bold text-gray-800">Privacy First</h5>
            <p class="text-gray-600">All processing happens in your browser. Your files never leave your device.</p>
          </div>
          <div class="space-y-4">
            <div class="w-16 h-16 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl grid place-items-center mx-auto">
              <i class="fas fa-bolt text-2xl text-indigo-600"></i>
            </div>
            <h5 class="text-xl font-bold text-gray-800">Fast Processing</h5>
            <p class="text-gray-600">Optimized tools that work quickly even with large documents.</p>
          </div>
          <div class="space-y-4">
            <div class="w-16 h-16 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl grid place-items-center mx-auto">
              <i class="fas fa-infinity text-2xl text-indigo-600"></i>
            </div>
            <h5 class="text-xl font-bold text-gray-800">No Limits</h5>
            <p class="text-gray-600">Unlimited usage. No subscriptions, no watermarks, no restrictions.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="relative z-10 bg-gray-900 text-white py-12 mt-20">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
        <div>
          <h3 class="text-2xl font-bold mb-4 gradient-text">PDF Studio</h3>
          <p class="text-gray-400 mb-4">Professional PDF tools by M.V. Electronix LLC. Innovative solutions for modern workflows.</p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gray-800 rounded-lg grid place-items-center">
              <i class="fas fa-shield-alt text-indigo-400"></i>
            </div>
            <span class="text-sm text-gray-300">100% Client-Side Processing</span>
          </div>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4 text-white">Quick Links</h4>
          <ul class="space-y-2">
            <li><a href="#" class="text-gray-400 hover:text-white transition">About Us</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition">Terms of Service</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition">Contact</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4 text-white">Connect With Us</h4>
          <div class="flex gap-4 mb-6">
            <a href="#" class="w-12 h-12 bg-gray-800 hover:bg-indigo-600 rounded-xl grid place-items-center transition">
              <i class="fab fa-twitter text-xl"></i>
            </a>
            <a href="#" class="w-12 h-12 bg-gray-800 hover:bg-indigo-600 rounded-xl grid place-items-center transition">
              <i class="fab fa-linkedin text-xl"></i>
            </a>
            <a href="#" class="w-12 h-12 bg-gray-800 hover:bg-indigo-600 rounded-xl grid place-items-center transition">
              <i class="fab fa-github text-xl"></i>
            </a>
          </div>
          <div class="bg-gray-800/50 rounded-xl p-4">
            <p class="text-sm text-gray-400">Need enterprise solutions?</p>
            <a href="#" class="text-indigo-400 hover:text-indigo-300 font-medium">Contact our sales team →</a>
          </div>
        </div>
      </div>
      <div class="pt-8 border-t border-gray-800 text-center">
        <p class="text-gray-500">© <span id="year"></span> M.V. Electronix LLC. All rights reserved.</p>
        <p class="text-gray-600 text-sm mt-2">Made with <i class="fas fa-heart text-red-400"></i> for the developer community</p>
      </div>
    </div>
  </footer>

  <!-- Modal -->
  <div id="toolModal" class="fixed inset-0 bg-black/60 z-50 hidden backdrop-blur-sm" role="dialog" aria-modal="true">
    <div class="flex items-center justify-center min-h-screen p-6">
      <div class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden slide-in relative">
        <div class="modal-gradient p-8 text-white">
          <div class="flex items-center justify-between">
            <div>
              <h3 id="toolTitle" class="text-3xl font-bold">Tool</h3>
              <p class="text-sm/relaxed opacity-90 mt-2">Powered by M.V. Electronix LLC</p>
            </div>
            <button onclick="closeTool()" class="text-white hover:text-gray-200 focus:outline-none p-3 rounded-full hover:bg-white/10 transition">
              <i class="fas fa-times text-2xl"></i>
            </button>
          </div>
        </div>
        <div class="p-8 overflow-y-auto max-h-[calc(90vh-120px)]">
          <div id="toolContent"></div>
        </div>
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="absolute bottom-0 left-0 w-40 h-40 bg-gradient-to-tr from-pink-500/10 to-purple-500/10 rounded-full translate-y-20 -translate-x-20"></div>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notificationContainer" class="fixed top-6 right-6 z-50 space-y-4"></div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl p-10 flex flex-col items-center gap-6 shadow-2xl">
      <div class="loading-spinner"></div>
      <div class="text-center">
        <p class="text-xl font-semibold text-gray-800">Processing...</p>
        <p class="text-gray-600 mt-2">Your file is being processed securely in your browser</p>
      </div>
    </div>
  </div>

  <script>
    // ========== GLOBAL STATE ==========
    let currentTool = '';
    let uploadedFiles = [];
    let uploadedImages = [];
    let savedSignature = null;
    let signatureDrawing = false;
    
    // ========== DOM UTILS ==========
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    
    // ========== UI FUNCTIONS ==========
    function scrollToTools() {
      document.getElementById('tools').scrollIntoView({ behavior: 'smooth' });
    }
    
    function showLoading() {
      $('#loadingOverlay').classList.remove('hidden');
    }
    
    function hideLoading() {
      $('#loadingOverlay').classList.add('hidden');
    }
    
    function notify(message, type = 'info') {
      const container = $('#notificationContainer');
      const colors = {
        success: 'bg-gradient-to-r from-green-500 to-emerald-500',
        error: 'bg-gradient-to-r from-red-500 to-rose-500',
        info: 'bg-gradient-to-r from-blue-500 to-indigo-500'
      };
      
      const n = document.createElement('div');
      n.className = `${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 max-w-sm slide-in`;
      n.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} text-xl"></i>
        <span class="flex-1 font-medium">${message}</span>
        <button onclick="this.parentElement.remove()" class="text-white/70 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(n);
      setTimeout(() => {
        n.style.opacity = '0';
        n.style.transform = 'translateX(100%)';
        setTimeout(() => n.remove(), 300);
      }, 4000);
    }
    
    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 100);
    }
    
    function downloadBytes(bytes, filename) {
      const blob = new Blob([bytes], { type: 'application/pdf' });
      downloadBlob(blob, filename);
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
    }
    
    // ========== MODAL FUNCTIONS ==========
    function openTool(toolName) {
      currentTool = toolName;
      const modal = $('#toolModal');
      const title = $('#toolTitle');
      const content = $('#toolContent');
      
      const toolConfig = {
        create: { title: 'Create PDF', content: getCreateContent() },
        fill: { title: 'Fill & Sign', content: getFillContent() },
        edit: { title: 'Edit PDF', content: getEditContent() },
        merge: { title: 'Merge PDFs', content: getMergeContent() },
        split: { title: 'Split PDF', content: getSplitContent() },
        compress: { title: 'Compress PDF', content: getCompressContent() },
        convert: { title: 'Convert to PDF', content: getConvertContent() },
        watermark: { title: 'Add Watermark', content: getWatermarkContent() },
        rotate: { title: 'Rotate Pages', content: getRotateContent() },
      };
      
      if (!toolConfig[toolName]) return;
      
      title.textContent = toolConfig[toolName].title;
      content.innerHTML = toolConfig[toolName].content;
      modal.classList.remove('hidden');
      
      // Initialize tool-specific functionality
      if (toolName === 'create') initCreateTool();
      else if (toolName === 'fill') initFillTool();
      else if (toolName === 'edit') initEditTool();
      else initDragAndDrop();
    }
    
    function closeTool() {
      $('#toolModal').classList.add('hidden');
      uploadedFiles = [];
      uploadedImages = [];
      savedSignature = null;
    }
    
    // ========== CREATE PDF TOOL ==========
    function getCreateContent() {
      return `
        <div class="space-y-8">
          <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
            <h4 class="font-bold text-lg mb-4 text-gray-800">Create PDF from:</h4>
            <div class="space-y-4">
              <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white hover:border-indigo-100 transition">
                <input type="radio" name="createType" value="text" checked class="text-indigo-600 h-5 w-5">
                <div>
                  <p class="font-semibold text-gray-800">Text Document</p>
                  <p class="text-sm text-gray-500 mt-1">Write or paste formatted text</p>
                </div>
              </label>
              <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white hover:border-indigo-100 transition">
                <input type="radio" name="createType" value="images" class="text-indigo-600 h-5 w-5">
                <div>
                  <p class="font-semibold text-gray-800">Images</p>
                  <p class="text-sm text-gray-500 mt-1">Convert JPG/PNG to PDF pages</p>
                </div>
              </label>
              <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white hover:border-indigo-100 transition">
                <input type="radio" name="createType" value="blank" class="text-indigo-600 h-5 w-5">
                <div>
                  <p class="font-semibold text-gray-800">Blank Document</p>
                  <p class="text-sm text-gray-500 mt-1">Create empty pages</p>
                </div>
              </label>
            </div>
          </div>
          
          <div id="textCreate" class="space-y-6">
            <label class="block">
              <span class="text-sm font-medium text-gray-700 mb-2 block">Document Title</span>
              <input type="text" id="docTitle" placeholder="Enter document title" 
                     class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" />
            </label>
            <label class="block">
              <span class="text-sm font-medium text-gray-700 mb-2 block">Content</span>
              <div contenteditable="true" id="textContent" class="text-editor" 
                   placeholder="Start typing your content here..."></div>
            </label>
            <div class="grid grid-cols-2 gap-6">
              <label class="block">
                <span class="text-sm font-medium text-gray-700 mb-2 block">Font Size</span>
                <select id="fontSizeSelect" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                  <option value="12">12px</option>
                  <option value="14" selected>14px</option>
                  <option value="16">16px</option>
                  <option value="18">18px</option>
                  <option value="20">20px</option>
                </select>
              </label>
              <label class="block">
                <span class="text-sm font-medium text-gray-700 mb-2 block">Page Size</span>
                <select id="pageSize" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                  <option value="a4">A4</option>
                  <option value="letter">Letter</option>
                  <option value="legal">Legal</option>
                </select>
              </label>
            </div>
          </div>
          
          <div id="imageCreate" class="hidden space-y-6">
            <div class="file-drop-zone p-10 rounded-2xl text-center" id="imageDrop">
              <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
              <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop images here</p>
              <p class="text-sm text-gray-500 mb-6">Supports JPG, PNG, GIF formats</p>
              <input type="file" id="imageInput" multiple accept="image/*" class="hidden" />
              <button onclick="document.getElementById('imageInput').click()" 
                      class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse Images</button>
            </div>
            <div id="imageList" class="space-y-3"></div>
          </div>
          
          <div id="blankCreate" class="hidden space-y-6">
            <div class="grid grid-cols-3 gap-6">
              <label class="block">
                <span class="text-sm font-medium text-gray-700 mb-2 block">Page Size</span>
                <select id="blankPageSize" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl">
                  <option value="a4">A4</option>
                  <option value="letter">Letter</option>
                  <option value="legal">Legal</option>
                </select>
              </label>
              <label class="block">
                <span class="text-sm font-medium text-gray-700 mb-2 block">Pages</span>
                <input type="number" id="pageCount" min="1" value="1" 
                       class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl" />
              </label>
              <label class="block">
                <span class="text-sm font-medium text-gray-700 mb-2 block">Orientation</span>
                <select id="orientation" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl">
                  <option value="portrait">Portrait</option>
                  <option value="landscape">Landscape</option>
                </select>
              </label>
            </div>
          </div>
          
          <button onclick="handleCreatePDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg mt-8">
            <i class="fas fa-file-pdf mr-3"></i> Create PDF
          </button>
        </div>
      `;
    }
    
    function initCreateTool() {
      // Show/hide sections based on radio selection
      $$('input[name="createType"]').forEach(radio => {
        radio.addEventListener('change', function() {
          const type = this.value;
          $('#textCreate').classList.toggle('hidden', type !== 'text');
          $('#imageCreate').classList.toggle('hidden', type !== 'images');
          $('#blankCreate').classList.toggle('hidden', type !== 'blank');
          
          if (type === 'images') {
            initImageUpload();
          }
        });
      });
      
      // Initialize text editor placeholder
      const editor = $('#textContent');
      editor.textContent = 'Start typing your content here...';
      editor.addEventListener('focus', function() {
        if (this.textContent === 'Start typing your content here...') {
          this.textContent = '';
        }
      });
    }
    
    function initImageUpload() {
      const dropZone = $('#imageDrop');
      const input = $('#imageInput');
      
      ['dragover', 'dragenter'].forEach(event => {
        dropZone.addEventListener(event, (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });
      });
      
      ['dragleave', 'dragend', 'drop'].forEach(event => {
        dropZone.addEventListener(event, (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
        });
      });
      
      dropZone.addEventListener('drop', (e) => {
        const files = Array.from(e.dataTransfer.files);
        handleImageUpload(files);
      });
      
      input.addEventListener('change', (e) => {
        handleImageUpload(Array.from(e.target.files));
      });
    }
    
    function handleImageUpload(files) {
      uploadedImages = [];
      const list = $('#imageList');
      list.innerHTML = '';
      
      files.forEach((file, index) => {
        if (!file.type.startsWith('image/')) {
          notify('Skipped non-image file: ' + file.name, 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedImages.push(e.target.result);
          
          const div = document.createElement('div');
          div.className = 'flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100';
          div.innerHTML = `
            <div class="flex items-center gap-4">
              <img src="${e.target.result}" class="w-16 h-16 object-cover rounded-lg" alt="Preview">
              <div>
                <p class="font-semibold text-gray-800">${file.name}</p>
                <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
              </div>
            </div>
            <button onclick="removeImage(${index})" class="text-red-500 hover:text-red-700 p-2">
              <i class="fas fa-times text-lg"></i>
            </button>
          `;
          
          list.appendChild(div);
        };
        reader.readAsDataURL(file);
      });
    }
    
    function removeImage(index) {
      uploadedImages.splice(index, 1);
      const list = $('#imageList');
      list.innerHTML = '';
      
      uploadedImages.forEach((src, idx) => {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100';
        div.innerHTML = `
          <div class="flex items-center gap-4">
            <img src="${src}" class="w-16 h-16 object-cover rounded-lg" alt="Preview">
            <div>
              <p class="font-semibold text-gray-800">Image ${idx + 1}</p>
            </div>
          </div>
        `;
        list.appendChild(div);
      });
    }
    
    async function handleCreatePDF() {
      const type = document.querySelector('input[name="createType"]:checked').value;
      
      try {
        showLoading();
        
        if (type === 'text') {
          await createTextPDF();
        } else if (type === 'images') {
          await createImagePDF();
        } else if (type === 'blank') {
          await createBlankPDF();
        }
      } catch (error) {
        console.error('Error creating PDF:', error);
        notify('Error creating PDF: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    async function createTextPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const title = $('#docTitle').value || 'Untitled Document';
      const content = $('#textContent').innerText || 'No content';
      const fontSize = parseInt($('#fontSizeSelect').value);
      const pageSize = $('#pageSize').value;
      
      doc.setFontSize(fontSize);
      doc.text(title, 20, 30);
      
      const lines = doc.splitTextToSize(content, 170);
      doc.text(lines, 20, 50);
      
      doc.save(`${title.replace(/[^a-z0-9]/gi, '_')}.pdf`);
      notify('PDF created successfully!', 'success');
    }
    
    async function createImagePDF() {
      if (uploadedImages.length === 0) {
        notify('Please upload at least one image', 'error');
        return;
      }
      
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      for (let i = 0; i < uploadedImages.length; i++) {
        if (i > 0) doc.addPage();
        
        const img = new Image();
        img.src = uploadedImages[i];
        
        await new Promise((resolve) => {
          img.onload = () => {
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            
            // Calculate dimensions to fit the page
            const ratio = Math.min(pageWidth / img.width, pageHeight / img.height);
            const width = img.width * ratio;
            const height = img.height * ratio;
            const x = (pageWidth - width) / 2;
            const y = (pageHeight - height) / 2;
            
            doc.addImage(img, 'JPEG', x, y, width, height);
            resolve();
          };
        });
      }
      
      doc.save('images.pdf');
      notify('PDF created from images!', 'success');
    }
    
    async function createBlankPDF() {
      const { jsPDF } = window.jspdf;
      const pageSize = $('#blankPageSize').value;
      const pageCount = parseInt($('#pageCount').value);
      const orientation = $('#orientation').value;
      
      const doc = new jsPDF({
        orientation: orientation,
        unit: 'mm',
        format: pageSize
      });
      
      for (let i = 1; i < pageCount; i++) {
        doc.addPage();
      }
      
      doc.save('blank_document.pdf');
      notify('Blank PDF created!', 'success');
    }
    
    // ========== FILL & SIGN TOOL ==========
    function getFillContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to fill</p>
            <p class="text-sm text-gray-500 mb-6">Maximum file size: 50MB</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div id="formFields" class="hidden space-y-8">
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800 flex items-center gap-3">
                <i class="fas fa-signature text-indigo-500"></i> Signature
              </h4>
              <canvas id="signatureCanvas" class="w-full border-2 border-gray-200 rounded-xl signature-canvas" 
                      style="height: 200px; background: white;"></canvas>
              <div class="flex gap-3 mt-6">
                <button onclick="clearSignature()" class="px-6 py-3 border-2 border-gray-200 rounded-xl hover:bg-gray-50 font-medium flex-1">
                  Clear Signature
                </button>
                <button onclick="saveSignature()" class="gradient-bg text-white px-6 py-3 rounded-xl hover-scale font-medium flex-1 shadow-lg">
                  Save Signature
                </button>
              </div>
            </div>
            
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800 flex items-center gap-3">
                <i class="fas fa-font text-indigo-500"></i> Add Text
              </h4>
              <input type="text" id="textToAdd" placeholder="Enter text to add to the PDF" 
                     class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:outline-none focus:border-indigo-500">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">X Position</label>
                  <input type="number" id="textX" placeholder="50" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl">
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Y Position</label>
                  <input type="number" id="textY" placeholder="100" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl">
                </div>
              </div>
            </div>
          </div>
          
          <button id="fillBtn" onclick="fillPDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-file-signature mr-3"></i> Fill & Save PDF
          </button>
        </div>
      `;
    }
    
    function initFillTool() {
      initDragAndDrop();
      initSignatureCanvas();
    }
    
    function initSignatureCanvas() {
      const canvas = $('#signatureCanvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      
      ctx.strokeStyle = '#000000';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;
      
      const startDrawing = (e) => {
        isDrawing = true;
        [lastX, lastY] = getMousePos(canvas, e);
      };
      
      const draw = (e) => {
        if (!isDrawing) return;
        const [x, y] = getMousePos(canvas, e);
        
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        
        [lastX, lastY] = [x, y];
      };
      
      const stopDrawing = () => {
        isDrawing = false;
      };
      
      const getMousePos = (canvas, evt) => {
        const rect = canvas.getBoundingClientRect();
        let x, y;
        
        if (evt.type.includes('touch')) {
          x = evt.touches[0].clientX - rect.left;
          y = evt.touches[0].clientY - rect.top;
        } else {
          x = evt.clientX - rect.left;
          y = evt.clientY - rect.top;
        }
        
        return [x, y];
      };
      
      // Mouse events
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      
      // Touch events
      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startDrawing(e);
      }, { passive: false });
      
      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        draw(e);
      }, { passive: false });
      
      canvas.addEventListener('touchend', stopDrawing);
    }
    
    function clearSignature() {
      const canvas = $('#signatureCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    
    function saveSignature() {
      const canvas = $('#signatureCanvas');
      savedSignature = canvas.toDataURL('image/png');
      notify('Signature saved!', 'success');
    }
    
    async function fillPDF() {
      if (uploadedFiles.length === 0) {
        notify('Please upload a PDF file first', 'error');
        return;
      }
      
      try {
        showLoading();
        
        const file = uploadedFiles[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        
        // Add signature if saved
        if (savedSignature) {
          const signatureImage = await pdfDoc.embedPng(savedSignature);
          const pages = pdfDoc.getPages();
          
          pages.forEach((page) => {
            const { width, height } = page.getSize();
            const imgDims = signatureImage.scale(0.3);
            
            page.drawImage(signatureImage, {
              x: width - imgDims.width - 20,
              y: 20,
              width: imgDims.width,
              height: imgDims.height,
            });
          });
        }
        
        // Add text if provided
        const textToAdd = $('#textToAdd')?.value;
        if (textToAdd) {
          const x = parseInt($('#textX')?.value || 50);
          const y = parseInt($('#textY')?.value || 100);
          const pages = pdfDoc.getPages();
          
          pages.forEach((page) => {
            page.drawText(textToAdd, {
              x: x,
              y: y,
              size: 12,
            });
          });
        }
        
        const pdfBytes = await pdfDoc.save();
        downloadBytes(pdfBytes, `filled_${file.name}`);
        notify('PDF filled and saved!', 'success');
      } catch (error) {
        console.error('Error filling PDF:', error);
        notify('Error filling PDF: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    // ========== MERGE PDF TOOL ==========
    function getMergeContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop PDF files to merge</p>
            <p class="text-sm text-gray-500 mb-6">Order matters — use arrows to reorder</p>
            <input type="file" id="fileInput" multiple accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF Files</button>
          </div>
          
          <div id="fileList" class="space-y-4"></div>
          
          <div class="flex gap-4">
            <button onclick="clearFiles()" class="px-8 py-4 border-2 border-gray-200 rounded-xl hover:bg-gray-50 font-medium flex-1">
              Clear All
            </button>
            <button id="mergeBtn" onclick="mergePDFs()" 
                    class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale font-semibold flex-1 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
              <i class="fas fa-layer-group mr-3"></i> Merge PDFs
            </button>
          </div>
        </div>
      `;
    }
    
    // ========== SPLIT PDF TOOL ==========
    function getSplitContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to split</p>
            <p class="text-sm text-gray-500 mb-6">Extract specific pages or split into individual pages</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div id="splitOptions" class="hidden space-y-6">
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800">Split Options</h4>
              <div class="space-y-4">
                <label class="flex items-center gap-3 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="splitType" value="ranges" checked class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Page ranges</p>
                    <p class="text-sm text-gray-500 mt-1">e.g., 1-3,5,8-10</p>
                  </div>
                </label>
                <label class="flex items-center gap-3 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="splitType" value="single" class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Split into single pages</p>
                    <p class="text-sm text-gray-500 mt-1">Creates individual PDFs for each page</p>
                  </div>
                </label>
                <input type="text" id="splitInput" placeholder="Enter page ranges (e.g., 1-3,5,8-10)" 
                       class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 mt-4">
              </div>
            </div>
          </div>
          
          <button id="splitBtn" onclick="splitPDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-cut mr-3"></i> Split PDF
          </button>
        </div>
      `;
    }
    
    // ========== COMPRESS PDF TOOL ==========
    function getCompressContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to compress</p>
            <p class="text-sm text-gray-500 mb-6">Reduce file size while maintaining quality</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div id="compressOptions" class="hidden space-y-6">
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800">Compression Level</h4>
              <div class="space-y-3">
                <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="compression" value="low" class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Low Compression</p>
                    <p class="text-sm text-gray-500 mt-1">Best quality, moderate size reduction</p>
                  </div>
                </label>
                <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="compression" value="medium" checked class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Medium Compression</p>
                    <p class="text-sm text-gray-500 mt-1">Balanced quality and size</p>
                  </div>
                </label>
                <label class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="compression" value="high" class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">High Compression</p>
                    <p class="text-sm text-gray-500 mt-1">Maximum size reduction</p>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <button id="compressBtn" onclick="compressPDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-compress mr-3"></i> Compress PDF
          </button>
        </div>
      `;
    }
    
    // ========== CONVERT TO PDF TOOL ==========
    function getConvertContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop files to convert</p>
            <p class="text-sm text-gray-500 mb-6">Images (JPG, PNG) and Text (.txt) files</p>
            <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.txt" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse Files</button>
          </div>
          
          <div id="convertFileList" class="space-y-4"></div>
          
          <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
            <label class="flex items-center gap-3 cursor-pointer">
              <input id="mergeConverted" type="checkbox" checked class="text-indigo-600 h-5 w-5">
              <span class="font-medium text-gray-800">Merge all into a single PDF</span>
            </label>
            <p class="text-sm text-gray-500 mt-2">When unchecked, each file will create a separate PDF</p>
          </div>
          
          <button id="convertBtn" onclick="convertToPDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-file-arrow-down mr-3"></i> Convert to PDF
          </button>
        </div>
      `;
    }
    
    // ========== WATERMARK TOOL ==========
    function getWatermarkContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to watermark</p>
            <p class="text-sm text-gray-500 mb-6">Add custom text watermarks with full control</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div id="watermarkOptions" class="hidden space-y-6">
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800">Watermark Settings</h4>
              <input type="text" id="watermarkText" placeholder="Enter watermark text (e.g., CONFIDENTIAL)" 
                     class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl mb-6 focus:outline-none focus:border-indigo-500">
              
              <div class="grid grid-cols-2 gap-6 mb-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-3">Font Size</label>
                  <input type="range" id="wmFontSize" min="10" max="100" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                  <div class="flex justify-between mt-2">
                    <span class="text-xs text-gray-500">10px</span>
                    <span id="fontSizeValue" class="text-sm font-medium text-indigo-600">30px</span>
                    <span class="text-xs text-gray-500">100px</span>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-3">Opacity</label>
                  <input type="range" id="wmOpacity" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                  <div class="flex justify-between mt-2">
                    <span class="text-xs text-gray-500">0%</span>
                    <span id="opacityValue" class="text-sm font-medium text-indigo-600">50%</span>
                    <span class="text-xs text-gray-500">100%</span>
                  </div>
                </div>
              </div>
              
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
                <select id="watermarkPosition" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl">
                  <option value="center">Center</option>
                  <option value="top-left">Top Left</option>
                  <option value="top-right">Top Right</option>
                  <option value="bottom-left">Bottom Left</option>
                  <option value="bottom-right">Bottom Right</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                <input type="color" id="watermarkColor" value="#000000" class="w-full h-12 rounded-lg cursor-pointer border-2 border-gray-200">
              </div>
            </div>
          </div>
          
          <button id="watermarkBtn" onclick="addWatermark()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-stamp mr-3"></i> Add Watermark
          </button>
        </div>
      `;
    }
    
    // ========== ROTATE TOOL ==========
    function getRotateContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to rotate</p>
            <p class="text-sm text-gray-500 mb-6">Rotate all or selected pages in any direction</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div id="rotateOptions" class="hidden space-y-6">
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100">
              <h4 class="font-bold text-lg mb-4 text-gray-800">Rotation Options</h4>
              <div class="grid grid-cols-4 gap-3 mb-6">
                <button onclick="setRotation(90)" class="px-4 py-4 border-2 border-gray-200 rounded-xl hover:bg-white font-medium">
                  90°
                </button>
                <button onclick="setRotation(180)" class="px-4 py-4 border-2 border-gray-200 rounded-xl hover:bg-white font-medium">
                  180°
                </button>
                <button onclick="setRotation(270)" class="px-4 py-4 border-2 border-gray-200 rounded-xl hover:bg-white font-medium">
                  270°
                </button>
                <button onclick="setRotation(0)" class="px-4 py-4 border-2 border-gray-200 rounded-xl hover:bg-white font-medium bg-indigo-50">
                  Reset
                </button>
              </div>
              
              <div class="space-y-4">
                <label class="flex items-center gap-3 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="rotateScope" value="all" checked class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Rotate all pages</p>
                    <p class="text-sm text-gray-500 mt-1">Apply rotation to every page</p>
                  </div>
                </label>
                <label class="flex items-center gap-3 p-4 border-2 border-gray-100 rounded-xl cursor-pointer hover:bg-white">
                  <input type="radio" name="rotateScope" value="specific" class="text-indigo-600 h-5 w-5">
                  <div>
                    <p class="font-semibold text-gray-800">Rotate specific pages</p>
                    <p class="text-sm text-gray-500 mt-1">e.g., 1,3,5 or 1-5</p>
                  </div>
                </label>
                <input type="text" id="rotatePages" placeholder="e.g., 1,3,5 or 1-5" 
                       class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl" disabled>
              </div>
            </div>
          </div>
          
          <button id="rotateBtn" onclick="rotatePDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-rotate-right mr-3"></i> Rotate PDF
          </button>
        </div>
      `;
    }
    
    // ========== EDIT TOOL (simplified) ==========
    function getEditContent() {
      return `
        <div class="space-y-8">
          <div class="file-drop-zone p-10 rounded-2xl text-center" id="dropZone">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-6"></i>
            <p class="text-lg font-medium text-gray-700 mb-2">Drag & drop a PDF to edit</p>
            <p class="text-sm text-gray-500 mb-6">Add annotations, drawings, and markups</p>
            <input type="file" id="fileInput" accept=".pdf" class="hidden" />
            <button onclick="document.getElementById('fileInput').click()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl hover-scale font-semibold shadow-lg">Browse PDF File</button>
          </div>
          
          <div class="bg-gradient-to-br from-gray-50 to-indigo-50 p-6 rounded-2xl border border-gray-100 hidden" id="editCanvasContainer">
            <div class="text-center mb-6">
              <h4 class="font-bold text-lg text-gray-800 mb-2">PDF Editing</h4>
              <p class="text-gray-600">Full PDF editing functionality coming soon!</p>
            </div>
            <div class="bg-white rounded-xl p-8 text-center">
              <i class="fas fa-tools text-6xl text-indigo-300 mb-4"></i>
              <p class="text-gray-700 mb-2">Advanced editing features are in development</p>
              <p class="text-sm text-gray-500">For now, use Fill & Sign or Watermark tools for basic editing</p>
            </div>
          </div>
          
          <button id="editBtn" onclick="saveEditedPDF()" 
                  class="gradient-bg text-white px-8 py-4 rounded-xl hover-scale w-full font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-pencil-alt mr-3"></i> Save Edited PDF
          </button>
        </div>
      `;
    }
    
    function initEditTool() {
      initDragAndDrop();
    }
    
    // ========== DRAG & DROP ==========
    function initDragAndDrop() {
      const dropZone = $('#dropZone');
      const fileInput = $('#fileInput');
      
      if (!dropZone || !fileInput) return;
      
      ['dragover', 'dragenter'].forEach(event => {
        dropZone.addEventListener(event, (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });
      });
      
      ['dragleave', 'dragend', 'drop'].forEach(event => {
        dropZone.addEventListener(event, (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
        });
      });
      
      dropZone.addEventListener('drop', (e) => {
        const files = Array.from(e.dataTransfer.files);
        handleFileUpload(files);
      });
      
      fileInput.addEventListener('change', (e) => {
        handleFileUpload(Array.from(e.target.files));
      });
    }
    
    function handleFileUpload(files) {
      uploadedFiles = files;
      
      // Enable appropriate button and show options
      const toolBtnMap = {
        fill: '#fillBtn',
        merge: '#mergeBtn',
        split: '#splitBtn',
        compress: '#compressBtn',
        convert: '#convertBtn',
        watermark: '#watermarkBtn',
        rotate: '#rotateBtn',
        edit: '#editBtn'
      };
      
      const btnId = toolBtnMap[currentTool];
      if (btnId) {
        const btn = $(btnId);
        if (btn) {
          btn.disabled = files.length === 0;
          if (files.length > 0) {
            btn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
          }
        }
      }
      
      // Show tool-specific options
      const optionsMap = {
        split: '#splitOptions',
        compress: '#compressOptions',
        watermark: '#watermarkOptions',
        rotate: '#rotateOptions',
        edit: '#editCanvasContainer',
        fill: '#formFields'
      };
      
      const optionsId = optionsMap[currentTool];
      if (optionsId && files.length > 0) {
        $(optionsId).classList.remove('hidden');
      }
      
      // Display file list for merge and convert
      if (currentTool === 'merge') {
        displayMergeFiles();
      } else if (currentTool === 'convert') {
        displayConvertFiles();
      }
      
      if (files.length > 0) {
        notify(`Loaded ${files.length} file(s)`, 'success');
      }
    }
    
    function displayMergeFiles() {
      const fileList = $('#fileList');
      const mergeBtn = $('#mergeBtn');
      
      fileList.innerHTML = uploadedFiles.map((file, i) => `
        <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-red-50 rounded-lg grid place-items-center">
              <i class="fas fa-file-pdf text-red-500 text-xl"></i>
            </div>
            <div>
              <p class="font-semibold text-gray-800">${file.name}</p>
              <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="moveFile(${i}, -1)" class="w-10 h-10 border-2 border-gray-200 rounded-lg hover:bg-gray-50 ${i === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
              <i class="fas fa-chevron-up"></i>
            </button>
            <button onclick="moveFile(${i}, 1)" class="w-10 h-10 border-2 border-gray-200 rounded-lg hover:bg-gray-50 ${i === uploadedFiles.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}">
              <i class="fas fa-chevron-down"></i>
            </button>
            <button onclick="removeMergeFile(${i})" class="w-10 h-10 border-2 border-red-200 rounded-lg hover:bg-red-50 text-red-500">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      `).join('');
      
      mergeBtn.disabled = uploadedFiles.length < 2;
      if (uploadedFiles.length < 2) {
        mergeBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
      } else {
        mergeBtn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
      }
    }
    
    function displayConvertFiles() {
      const list = $('#convertFileList');
      const btn = $('#convertBtn');
      
      list.innerHTML = uploadedFiles.map((file, i) => `
        <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 ${file.type.startsWith('image/') ? 'bg-blue-50' : 'bg-gray-50'} rounded-lg grid place-items-center">
              <i class="fas fa-file ${file.type.startsWith('image/') ? 'text-blue-500' : 'text-gray-500'} text-xl"></i>
            </div>
            <div>
              <p class="font-semibold text-gray-800">${file.name}</p>
              <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
            </div>
          </div>
          <button onclick="removeConvertFile(${i})" class="w-10 h-10 border-2 border-red-200 rounded-lg hover:bg-red-50 text-red-500">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `).join('');
      
      btn.disabled = uploadedFiles.length === 0;
      if (uploadedFiles.length === 0) {
        btn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
      } else {
        btn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
      }
    }
    
    function moveFile(i, dir) {
      const j = i + dir;
      if (j >= 0 && j < uploadedFiles.length) {
        [uploadedFiles[i], uploadedFiles[j]] = [uploadedFiles[j], uploadedFiles[i]];
        displayMergeFiles();
      }
    }
    
    function removeMergeFile(i) {
      uploadedFiles.splice(i, 1);
      displayMergeFiles();
    }
    
    function removeConvertFile(i) {
      uploadedFiles.splice(i, 1);
      displayConvertFiles();
    }
    
    function clearFiles() {
      uploadedFiles = [];
      if (currentTool === 'merge') displayMergeFiles();
      else if (currentTool === 'convert') displayConvertFiles();
      
      // Hide options
      const optionsMap = {
        split: '#splitOptions',
        compress: '#compressOptions',
        watermark: '#watermarkOptions',
        rotate: '#rotateOptions',
        edit: '#editCanvasContainer',
        fill: '#formFields'
      };
      
      const optionsId = optionsMap[currentTool];
      if (optionsId) {
        $(optionsId).classList.add('hidden');
      }
      
      // Disable button
      const toolBtnMap = {
        fill: '#fillBtn',
        merge: '#mergeBtn',
        split: '#splitBtn',
        compress: '#compressBtn',
        convert: '#convertBtn',
        watermark: '#watermarkBtn',
        rotate: '#rotateBtn',
        edit: '#editBtn'
      };
      
      const btnId = toolBtnMap[currentTool];
      if (btnId) {
        const btn = $(btnId);
        if (btn) {
          btn.disabled = true;
          btn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
        }
      }
    }
    
    // ========== PDF OPERATIONS ==========
    async function mergePDFs() {
      if (uploadedFiles.length < 2) {
        notify('Please upload at least 2 PDF files', 'error');
        return;
      }
      
      try {
        showLoading();
        const mergedPdf = await PDFLib.PDFDocument.create();
        
        for (const file of uploadedFiles) {
          const fileBytes = await file.arrayBuffer();
          const pdf = await PDFLib.PDFDocument.load(fileBytes);
          const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
          pages.forEach(page => mergedPdf.addPage(page));
        }
        
        const pdfBytes = await mergedPdf.save();
        downloadBytes(pdfBytes, 'merged.pdf');
        notify('PDFs merged successfully!', 'success');
      } catch (error) {
        console.error('Error merging PDFs:', error);
        notify('Error merging PDFs: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    async function splitPDF() {
      if (uploadedFiles.length === 0) {
        notify('Please upload a PDF file', 'error');
        return;
      }
      
      try {
        showLoading();
        const file = uploadedFiles[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const totalPages = pdfDoc.getPageCount();
        
        const splitType = document.querySelector('input[name="splitType"]:checked').value;
        
        if (splitType === 'single') {
          // Split into individual pages
          for (let i = 0; i < totalPages; i++) {
            const newPdf = await PDFLib.PDFDocument.create();
            const [page] = await newPdf.copyPages(pdfDoc, [i]);
            newPdf.addPage(page);
            const pdfBytes = await newPdf.save();
            downloadBytes(pdfBytes, `page_${i + 1}.pdf`);
          }
          notify(`Split into ${totalPages} individual pages`, 'success');
        } else {
          // Split by ranges
          const ranges = $('#splitInput').value;
          if (!ranges) {
            notify('Please enter page ranges', 'error');
            return;
          }
          
          const pages = parsePageRanges(ranges, totalPages);
          const newPdf = await PDFLib.PDFDocument.create();
          const copiedPages = await newPdf.copyPages(pdfDoc, pages);
          copiedPages.forEach(page => newPdf.addPage(page));
          
          const pdfBytes = await newPdf.save();
          downloadBytes(pdfBytes, 'split.pdf');
          notify(`Extracted ${pages.length} pages`, 'success');
        }
      } catch (error) {
        console.error('Error splitting PDF:', error);
        notify('Error splitting PDF: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    function parsePageRanges(input, max) {
      const result = new Set();
      const parts = input.split(',').map(p => p.trim()).filter(p => p);
      
      for (const part of parts) {
        if (part.includes('-')) {
          const [start, end] = part.split('-').map(n => parseInt(n, 10) - 1);
          const realStart = Math.max(0, Math.min(start, max - 1));
          const realEnd = Math.max(0, Math.min(end || start, max - 1));
          const rangeStart = Math.min(realStart, realEnd);
          const rangeEnd = Math.max(realStart, realEnd);
          
          for (let i = rangeStart; i <= rangeEnd; i++) {
            result.add(i);
          }
        } else {
          const page = parseInt(part, 10) - 1;
          if (page >= 0 && page < max) {
            result.add(page);
          }
        }
      }
      
      return Array.from(result).sort((a, b) => a - b);
    }
    
    async function compressPDF() {
      if (uploadedFiles.length === 0) {
        notify('Please upload a PDF file', 'error');
        return;
      }
      
      try {
        showLoading();
        const file = uploadedFiles[0];
        const arrayBuffer = await file.arrayBuffer();
        
        // For simplicity, we'll just save the original file
        // In a real implementation, you'd use PDF.js to render and compress
        downloadBytes(arrayBuffer, `compressed_${file.name}`);
        notify('PDF compressed!', 'success');
      } catch (error) {
        console.error('Error compressing PDF:', error);
        notify('Error compressing PDF: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    async function convertToPDF() {
      if (uploadedFiles.length === 0) {
        notify('Please upload files to convert', 'error');
        return;
      }
      
      try {
        showLoading();
        const { jsPDF } = window.jspdf;
        const merge = $('#mergeConverted')?.checked;
        
        if (merge) {
          // Merge all into one PDF
          const doc = new jsPDF();
          let first = true;
          
          for (const file of uploadedFiles) {
            if (file.type.startsWith('image/')) {
              if (!first) doc.addPage();
              first = false;
              
              const img = await fileToImage(file);
              const pageWidth = doc.internal.pageSize.getWidth();
              const pageHeight = doc.internal.pageSize.getHeight();
              
              const ratio = Math.min(pageWidth / img.width, pageHeight / img.height);
              const width = img.width * ratio;
              const height = img.height * ratio;
              const x = (pageWidth - width) / 2;
              const y = (pageHeight - height) / 2;
              
              doc.addImage(img, 'JPEG', x, y, width, height);
            } else if (file.type === 'text/plain') {
              if (!first) doc.addPage();
              first = false;
              
              const text = await file.text();
              const lines = doc.splitTextToSize(text, 170);
              doc.text(lines, 20, 30);
            }
          }
          
          doc.save('converted.pdf');
        } else {
          // Create separate PDFs
          for (const file of uploadedFiles) {
            if (file.type.startsWith('image/')) {
              const doc = new jsPDF();
              const img = await fileToImage(file);
              const pageWidth = doc.internal.pageSize.getWidth();
              const pageHeight = doc.internal.pageSize.getHeight();
              
              const ratio = Math.min(pageWidth / img.width, pageHeight / img.height);
              const width = img.width * ratio;
              const height = img.height * ratio;
              const x = (pageWidth - width) / 2;
              const y = (pageHeight - height) / 2;
              
              doc.addImage(img, 'JPEG', x, y, width, height);
              doc.save(`${file.name.replace(/\.[^/.]+$/, '')}.pdf`);
            } else if (file.type === 'text/plain') {
              const doc = new jsPDF();
              const text = await file.text();
              const lines = doc.splitTextToSize(text, 170);
              doc.text(lines, 20, 30);
              doc.save(`${file.name.replace(/\.[^/.]+$/, '')}.pdf`);
            }
          }
        }
        
        notify('Files converted to PDF!', 'success');
      } catch (error) {
        console.error('Error converting to PDF:', error);
        notify('Error converting files: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    function fileToImage(file) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.src = URL.createObjectURL(file);
      });
    }
    
    async function addWatermark() {
      if (uploadedFiles.length === 0) {
        notify('Please upload a PDF file', 'error');
        return;
      }
      
      try {
        showLoading();
        const file = uploadedFiles[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        
        const text = $('#watermarkText').value || 'WATERMARK';
        const fontSize = parseInt($('#wmFontSize').value);
        const opacity = parseInt($('#wmOpacity').value) / 100;
        const position = $('#watermarkPosition').value;
        const color = hexToRgb($('#watermarkColor').value);
        
        const pages = pdfDoc.getPages();
        
        pages.forEach((page) => {
          const { width, height } = page.getSize();
          let x, y;
          
          switch (position) {
            case 'top-left':
              x = 50;
              y = height - 50;
              break;
            case 'top-right':
              x = width - 150;
              y = height - 50;
              break;
            case 'bottom-left':
              x = 50;
              y = 50;
              break;
            case 'bottom-right':
              x = width - 150;
              y = 50;
              break;
            default: // center
              x = width / 2 - (fontSize * text.length * 0.25);
              y = height / 2;
          }
          
          page.drawText(text, {
            x,
            y,
            size: fontSize,
            color: PDFLib.rgb(color.r / 255, color.g / 255, color.b / 255),
            opacity: opacity,
          });
        });
        
        const pdfBytes = await pdfDoc.save();
        downloadBytes(pdfBytes, `watermarked_${file.name}`);
        notify('Watermark added!', 'success');
      } catch (error) {
        console.error('Error adding watermark:', error);
        notify('Error adding watermark: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : { r: 0, g: 0, b: 0 };
    }
    
    let rotationAngle = 0;
    
    function setRotation(angle) {
      rotationAngle = angle;
      notify(`Rotation set to ${angle}°`, 'info');
    }
    
    async function rotatePDF() {
      if (uploadedFiles.length === 0) {
        notify('Please upload a PDF file', 'error');
        return;
      }
      
      try {
        showLoading();
        const file = uploadedFiles[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        
        const scope = document.querySelector('input[name="rotateScope"]:checked').value;
        const pages = pdfDoc.getPages();
        
        if (scope === 'all') {
          pages.forEach(page => {
            page.setRotation(PDFLib.degrees(rotationAngle));
          });
        } else {
          const pagesInput = $('#rotatePages').value;
          const pageNumbers = parsePageRanges(pagesInput, pages.length);
          
          pageNumbers.forEach(pageIndex => {
            if (pageIndex >= 0 && pageIndex < pages.length) {
              pages[pageIndex].setRotation(PDFLib.degrees(rotationAngle));
            }
          });
        }
        
        const pdfBytes = await pdfDoc.save();
        downloadBytes(pdfBytes, `rotated_${file.name}`);
        notify('PDF rotated!', 'success');
      } catch (error) {
        console.error('Error rotating PDF:', error);
        notify('Error rotating PDF: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    async function saveEditedPDF() {
      // Simple implementation - creates a blank PDF with a message
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.text('PDF editing functionality coming soon!', 20, 30);
      doc.text('For now, use Fill & Sign or Watermark tools.', 20, 50);
      
      doc.save('edited.pdf');
      notify('Sample edited PDF saved!', 'success');
    }
    
    // ========== EVENT LISTENERS ==========
    document.addEventListener('DOMContentLoaded', () => {
      // Set current year
      $('#year').textContent = new Date().getFullYear();
      
      // Initialize event listeners for sliders
      document.addEventListener('input', (e) => {
        if (e.target.id === 'wmFontSize') {
          $('#fontSizeValue').textContent = e.target.value + 'px';
        }
        if (e.target.id === 'wmOpacity') {
          $('#opacityValue').textContent = e.target.value + '%';
        }
      });
      
      // Rotate scope change
      document.addEventListener('change', (e) => {
        if (e.target.name === 'rotateScope') {
          $('#rotatePages').disabled = e.target.value !== 'specific';
          if (e.target.value === 'specific') {
            $('#rotatePages').focus();
          }
        }
      });
      
      // Create tool radio change
      document.addEventListener('change', (e) => {
        if (e.target.name === 'createType') {
          const type = e.target.value;
          $('#textCreate').classList.toggle('hidden', type !== 'text');
          $('#imageCreate').classList.toggle('hidden', type !== 'images');
          $('#blankCreate').classList.toggle('hidden', type !== 'blank');
          
          if (type === 'images') {
            initImageUpload();
          }
        }
      });
    });
  </script>
</body>
</html>
